# IN A Mess

首先是源码里有个提示index.phps，是一道审计题。

几个变量都是`$_GET`获取的，大概是这么几个点需要绕过。

`!$_GET['id']`要为假，但是`$_GET['id'] == 0`。这个只需要在字符串里出现奇特的字符即可，比如'0.'。

`$_GET['a']`不能包含`'.'`，且`file_get_contents($_GET['a'], 'r')`的内容恰好为`"1112 is a nice lab!"`。这有多种方法可以实现，我采用的是往服务器上传文件，并用纯数字形式的ip地址访问我的服务器。或者用php伪协议`php://input`然后post数据上去。

`eregi("111" . substr($_GET['b'], 0, 1), "1114)`为真且`substr($_GET['b'], 0, 1) != 4`，且`strlen($_GET['b']) > 5`，我这里将`$_GET['b]`设置为`......`，作为正则表达式可以匹配任何字符，于是就匹配上了4，且不等于4，长度也满足要求。不过`eregi`的考点大多是NUL字符截断，这题也可以这样做。

符合题意了之后程序`require 'flag.txt'`，提交了两三次，发现这个不是flag，还是个目录……进入目录后来到里站。

还是先访问index.phps，不过这次没有了。随便改了一下GET参数，发现是一个SQL语句的一部分（嗯？你问我怎么看出来的？它把语句打印出来了啊……）然后随便改了几下，发现语句合法返回结果，否则返回语句。

有几个明显的waf需要绕过，首先是空格，然后是`/**/`，这个可以用`/***/`直接绕过。然后小写的`union`会被删去，大写没问题。`\bSELECT\b`无论大小写都是敏感词，不能单独出现，滤去`\bSELECT\b`后后端还会再删去一次`select`（小写），所以重写一遍两个都可以解决。

试了一下发现显位是第三个，于是开始注入。爆表名字段名，然后拿flag。
